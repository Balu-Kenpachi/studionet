<script type="text/javascript" src="../user/javascripts/graphs/graph-helper.js"></script>
<!-- Stylesheet for graph -->
<link rel='stylesheet' href='./stylesheets/graph-style.css' />
<!-- tables -->

<!-- <div id='user-graph'></div> -->

<!-- actual graph container -->
<div class='graph-container'>

  <div id='user-graph'></div>
  
  <div class='graph-controls'>
    <!-- reset graph -->
    <i class="graph-nav-control icon fa fa-expand" ng-click='resetGraph()'></i>

    <!-- create a contribution -->
    <i class="graph-nav-control icon fa fa-plus" ng-click='createGroup()'></i>
  </div>
   
</div>

<!-- create a group button -->
<!-- <div class="btn-floating">
  <div class="btn-bg"></div>
  <button type="button"  class="btn btn-default btn-toggle" 
    data-toggle="modal" data-target="#createGroupModal">
    <i class="icon fa fa-plus"></i>
    <span class="help-text">Shortcut</span>
  </button></a>
</div> -->



<!--- View Modal -->
<div class="modal fade" id="viewModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title text-center">{{activeGroup.name}}</h4>

        <!-- Admin Fn -->
        <button class='btn btn-link pull-right edit-button' data-toggle="modal" data-target="#editModal" data-dismiss="modal" ng-if='activeElement.role=="Admin"'>
          <i class='fa fa-pencil'></i>
        </button>

      </div>

      <div class="modal-body">

        <!-- Body for Viewing -->
        <div class='row'>
          <div class='col-sm-3'><i class="icon fa fa-tasks fa-4x"></i></div>
          <div class='col-sm-9' ng-bind-html="activeGroup.description">
          </div>
        </div>

        <br><br>

        <div class='row'>
          <div class='col-sm-3'><i class="icon fa fa-users fa-4x"></i></div>
          <div class='col-sm-9'>
            <p><b>User Count: </b> {{ activeGroup.users }}
                <!-- Admin fn -->
                <button class='btn btn-link pull-right edit-button' data-toggle="modal" data-target="#addUserModal" data-dismiss="modal"  ng-if='activeElement.role=="Admin"'>
              <i class='fa fa-user-plus'></i>
            </button>

            </p>
            
            <p><b>Created By: </b>{{ users[ activeGroup.createdBy ].name }}</p>
            
            <p><b>Type: </b>{{activeGroup.restricted == true ? "Closed Group" : "Open Group"}}</p>
          </div>
        </div>

      </div>

      <div class='modal-footer'>
        <!-- buttons -->
            
            <!-- Close -->
            <button type="button" class="btn btn-sm btn-default" data-dismiss="modal" 
              ng-click ='leaveGroup()' ng-if='activeElement.role=="Member"'>
             Leave Group
            </button>

            <button type="button" class="btn btn-sm btn-default" data-dismiss="modal" 
              ng-click ='joinGroup()' ng-if='activeElement.role==undefined && activeElement.properties.restricted==false'>
             Join Group
            </button>

            <!-- Admin Fn -->
            <button type="button" class='btn btn-sm btn-default' data-toggle="modal" data-dismiss="modal" ng-if='activeElement.role=="Admin"' ng-click='deleteGroup()'>
              Delete
            </button>

            <!-- Close -->
            <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">
              Close
            </button>
      
      </div>


    </div>
  </div>
</div>

<!--- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Editing {{ activeGroup.name }}</h4>
      </div>
      <div class="modal-body">
        
        <div class='row'>
          <!-- Body for Creating -->         
          <div class="section">
              <div class="section-body">

                <div class="form-group">
                  <label class="col-md-3 control-label">Name</label>
                  <div class="col-md-9">
                    <input type="text" class="form-control" placeholder="" ng-model='activeGroup.name'>
                  </div>
                </div>

                <div class="form-group">
                  <div class="col-md-3">
                    <label class="control-label">Description</label>
                  </div>
                  <div class="col-md-9">
                    <textarea class="form-control" ng-model='activeGroup.description'></textarea>
                  </div>
                </div>

                <br><br>
                <div class="form-group">
                  <label class="col-md-3 control-label">Type</label>
                  <div class="col-md-9"> 
                    <select class="col-md-9" ng-model='activeGroup.restricted'> 
                      <option value=false>Open Group</option>
                      <option value=true>Closed Group</option>
                    </select>
                  </div>
                </div>

              </div>
          </div>
        </div>

      </div>

      <div class="modal-footer">

          <!-- buttons -->
          <!-- Save -->
          <button type="button" class="btn btn-sm btn-default" ng-click=saveGroupEdit()>
            Save Changes
          </button>

          <!-- Cancel -->
          <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">
            Close
          </button>

      </div>

    </div>
  </div>
</div>


<!--- Add Users Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title">{{activeGroup.name}} Members</h4>
      </div>

      <div class="modal-body height-400">
        <div class='row'>
          <div class="col-xs-12">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <th>NUS OpenID</th>
                  <th>Name</th>
                  <th>Member</th>
                </tr>
              </thead>
              <tbody ng-repeat="user in users">
                <tr ng-click="addUser(user)">
                  <th>{{user.nusOpenId}}</th>
                  <th>{{user.name}}</th>
                  <th>{{user.status}}</th>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class='modal-footer'>
        <!-- buttons -->
            
          <!-- Close -->
          <button type="button" class="btn btn-sm btn-default pull-right" data-dismiss="modal"> Close </button>

      </div>


    </div>
  </div>
</div>



<!--- 'Create' Modal -->
<div class="modal fade" id="createGroupModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Creating {{activeGroup.name == "" ? "Group" : activeGroup.name}}</h4>
      </div>
      <div class="modal-body">
        
        <div class='row'>
          <!-- Body for Creating -->         
          <div class="section">
              <div class='section-title'>General Information</div>
              <div class="section-body">

                <div class="form-group">
                  <label class="col-md-3 control-label">Name</label>
                  <div class="col-md-9">
                    <input type="text" class="form-control" placeholder="" ng-model='activeGroup.name'>
                  </div>
                </div>

                <div class="form-group">
                  <div class="col-md-3">
                    <label class="control-label">Description</label>
                  </div>
                  <div class="col-md-9">
                    <textarea class="form-control" ng-model='activeGroup.description'></textarea>
                  </div>
                </div>

                <br><br>
                <div class="form-group">
                  <label class="col-md-3 control-label">Type</label>
                  <div class="col-md-9"> 
                    <select class="col-md-9" ng-model='activeGroup.restricted'> 
                      <option value=false>Open Group</option>
                      <option value=true>Closed Group</option>
                    </select>
                  </div>
                </div>

              </div>
          </div>
        </div>

        <br><br>

        <div class='row'>
          <div class="section">
            <div class='section-title'>Inheritance (cannot be changed later)</div>
            <div class='section-body'>
              


              <div class="form-group">
                <label class="col-md-4 control-label">Parent Group:{{activeGroup.groupParentId}}</label>
                <div class="col-md-8">
                  <select class="col-md-7" ng-model='activeGroup.groupParentId'>
                    <option ng-repeat='group in groups' value={{group.id}}>
                    {{group.name}} ({{group.id}})
                    </option>
                  </select>
                </div>
              </div>

            </div>
          </div>
        </div>

      </div>

      <div class="modal-footer">

          <!-- buttons -->
            
              <!-- Save -->
              <button type="button" class="btn btn-sm btn-default" ng-click=saveGroup()>
                  Create
              </button>

              <!-- Cancel -->
              <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">
                Cancel
              </button>

      </div>

    </div>
  </div>
</div>
